version: '2'

services:
  plex:
    extends: 
      file: ${DOCKER_MEDIA_SERVER}/docker-compose.yml
      service: plex
    labels:
      - "traefik.docker.network=main"
      - "traefik.enable=true"
      - "traefik.basic.frontend.rule=Host:plex.${DOMAIN_URL}"
      - "traefik.basic.port=32400"
      - "traefik.basic.protocol=http"
      - "traefik.backend.healthcheck.path=/web/index.html"
      - "traefik.backend.healthcheck.interval=30s"
    volumes:
      - "${STORAGE_LOCATION}/plex:/config"
      - "${STORAGE_LOCATION}/sonarr/tvseries:/tv"
      - "${STORAGE_LOCATION}/radarr/movies:/movies"
      - "${STORAGE_LOCATION}/plex:/transcode"
      - "${FILEBROWSER_HOME}:/home"
    networks:
      - main
  sonarr:
    extends: 
      file: ${DOCKER_MEDIA_SERVER}/docker-compose.yml
      service: sonarr
    labels:
      - "traefik.docker.network=main"
      - "traefik.enable=true"
      - "traefik.basic.frontend.rule=Host:sonarr.${DOMAIN_URL}"
      - "traefik.basic.port=8989"
      - "traefik.basic.protocol=http"
      - "traefik.backend.healthcheck.path=/api/system/status?apikey=${SONARR_API_KEY}"
      - "traefik.backend.healthcheck.interval=30s"
    networks:
      - main
  radarr:
    extends: 
      file: ${DOCKER_MEDIA_SERVER}/docker-compose.yml
      service: radarr
    labels:
      - "traefik.docker.network=main"
      - "traefik.enable=true"
      - "traefik.basic.frontend.rule=Host:radarr.${DOMAIN_URL}"
      - "traefik.basic.port=7878"
      - "traefik.basic.protocol=http"
      - "traefik.backend.healthcheck.path=/api/system/status?apikey=${RADARR_API_KEY}"
      - "traefik.backend.healthcheck.interval=30s"
    networks:
      - main


networks:
  main:
    external: true