version: '2'

services:
  transmission:
    extends: 
      file: ${DOCKER_MEDIA_SERVER}/docker-compose.yml
      service: transmission
    labels:
      - "traefik.docker.network=main"
      - "traefik.enable=true"
      - "traefik.basic.frontend.rule=Host:transmission.${DOMAIN_URL}"
      - "traefik.basic.port=9091"
      - "traefik.frontend.entryPoints=http,https"
      - traefik.frontend.auth.forward.address=${OAUTH_FORWARD_URL}
      - traefik.frontend.auth.forward.authResponseHeaders=X-Forwarded-User
      - traefik.frontend.auth.forward.trustForwardHeader=true
    networks:
      - main

  radarr:
    extends: 
      file: ${DOCKER_MEDIA_SERVER}/docker-compose.yml
      service: radarr
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - "${STORAGE_LOCATION}/radarr/config:/config"
      - "${STORAGE_LOCATION}/radarr/movies:/movies"
      - "${STORAGE_LOCATION}/transmission/downloads:/downloads"
    labels:
      - "traefik.docker.network=main"
      - "traefik.enable=true"
      - "traefik.basic.frontend.rule=Host:radarr.${DOMAIN_URL}"
      - traefik.backend=radarr
      - "traefik.basic.port=7878"
      - "traefik.frontend.entryPoints=http,https"
      - traefik.frontend.auth.forward.address=${OAUTH_FORWARD_URL}
      - traefik.frontend.auth.forward.authResponseHeaders=X-Forwarded-User
      - traefik.frontend.auth.forward.trustForwardHeader=true
    networks:
      - main


  plex:
    extends: 
      file: ${DOCKER_MEDIA_SERVER}/docker-compose.yml
      service: plex
    labels:
      - "traefik.docker.network=main"
      - "traefik.enable=true"
      - "traefik.basic.frontend.rule=Host:plex.${DOMAIN_URL}"
      - "traefik.basic.port=32400"
      - "traefik.frontend.entryPoints=http,https"
      - "traefik.backend.healthcheck.path=/web/index.html"
      - "traefik.backend.healthcheck.interval=30s"
    volumes:
      - "${STORAGE_LOCATION}/plex:/config"
      - "${STORAGE_LOCATION}/sonarr/tvseries:/tv"
      - "${STORAGE_LOCATION}/radarr/movies:/movies"
      - "${STORAGE_LOCATION}/deezldr/music:/music"
      - "${STORAGE_LOCATION}/plex:/transcode"
      - "${FILEBROWSER_HOME}:/home"
    networks:
      - main

networks:
  main:
    external: true